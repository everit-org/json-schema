


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=windows-1252"> 
  <title>Coverage Report > JsonValue</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.everit.json.schema.loader</a>
</div>

<h1>Coverage Summary for Class: JsonValue (org.everit.json.schema.loader)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">JsonValue</td>
<td class="coverageStat">
  <span class="percent">
    96.2%
  </span>
  <span class="absValue">
    (25/26)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    86.1%
  </span>
  <span class="absValue">
    (31/36)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    93.5%
  </span>
  <span class="absValue">
    (58/62)
  </span>
</td>
</tr>
  <tr>
    <td class="name">JsonValue$Multiplexer</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (4/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (2/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (14/14)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JsonValue$VoidMultiplexer</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (4/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (8/8)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JsonValue$VoidMultiplexerWithSchemaPredicate</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (3/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (2/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (10/10)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    97.3%
  </span>
  <span class="absValue">
    (36/37)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    87.5%
  </span>
  <span class="absValue">
    (35/40)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    95.7%
  </span>
  <span class="absValue">
    (90/94)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package org.everit.json.schema.loader;
&nbsp;
&nbsp;import static org.everit.json.schema.loader.OrgJsonUtil.toList;
&nbsp;import static org.everit.json.schema.loader.OrgJsonUtil.toMap;
&nbsp;import static org.everit.json.schema.loader.SpecificationVersion.DRAFT_4;
&nbsp;
&nbsp;import java.util.HashMap;
&nbsp;import java.util.HashSet;
&nbsp;import java.util.List;
&nbsp;import java.util.Map;
&nbsp;import java.util.Objects;
&nbsp;import java.util.Set;
&nbsp;import java.util.function.Consumer;
&nbsp;import java.util.function.Function;
&nbsp;
&nbsp;import org.everit.json.schema.SchemaException;
&nbsp;import org.json.JSONArray;
&nbsp;import org.json.JSONObject;
&nbsp;
&nbsp;/**
&nbsp; * @author erosb
&nbsp; */
&nbsp;class JsonValue {
&nbsp;
&nbsp;    class Multiplexer&lt;R&gt; {
&nbsp;
<b class="fc">&nbsp;        protected Map&lt;Class&lt;?&gt;, Function&lt;?, R&gt;&gt; actions = new HashMap&lt;&gt;();</b>
&nbsp;
<b class="fc">&nbsp;        Multiplexer(Class&lt;?&gt; expectedType, Function&lt;?, R&gt; mapper) {</b>
<b class="fc">&nbsp;            actions.put(expectedType, mapper);</b>
&nbsp;        }
&nbsp;
&nbsp;        &lt;T&gt; Multiplexer&lt;R&gt; orMappedTo(Class&lt;T&gt; expectedType, Function&lt;T, R&gt; mapper) {
<b class="fc">&nbsp;            actions.put(expectedType, mapper);</b>
<b class="fc">&nbsp;            return this;</b>
&nbsp;        }
&nbsp;
&nbsp;        R requireAny() {
<b class="fc">&nbsp;            if (typeOfValue() == null) {</b>
<b class="fc">&nbsp;                throw multiplexFailure();</b>
&nbsp;            }
<b class="fc">&nbsp;            Function&lt;Object, R&gt; consumer = (Function&lt;Object, R&gt;) actions.keySet().stream()</b>
<b class="fc">&nbsp;                    .filter(clazz -&gt; clazz.isAssignableFrom(typeOfValue()))</b>
<b class="fc">&nbsp;                    .findFirst()</b>
<b class="fc">&nbsp;                    .map(actions::get)</b>
<b class="fc">&nbsp;                    .orElseThrow(() -&gt; multiplexFailure());</b>
<b class="fc">&nbsp;            return consumer.apply(value());</b>
&nbsp;        }
&nbsp;
&nbsp;        protected SchemaException multiplexFailure() {
<b class="fc">&nbsp;            return ls.createSchemaException(typeOfValue(), actions.keySet());</b>
&nbsp;        }
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    class VoidMultiplexer extends Multiplexer&lt;Void&gt; {
&nbsp;
<b class="fc">&nbsp;        VoidMultiplexer(Class&lt;?&gt; expectedType, Consumer&lt;?&gt; consumer) {</b>
<b class="fc">&nbsp;            super(expectedType, obj -&gt; {</b>
<b class="fc">&nbsp;                ((Consumer&lt;Object&gt;) consumer).accept(obj);</b>
<b class="fc">&nbsp;                return null;</b>
&nbsp;            });
&nbsp;        }
&nbsp;
&nbsp;        &lt;T&gt; VoidMultiplexer or(Class&lt;T&gt; expectedType, Consumer&lt;T&gt; consumer) {
<b class="fc">&nbsp;            actions.put(expectedType, obj -&gt; {</b>
<b class="fc">&nbsp;                ((Consumer&lt;Object&gt;) consumer).accept(obj);</b>
<b class="fc">&nbsp;                return null;</b>
&nbsp;            });
<b class="fc">&nbsp;            return this;</b>
&nbsp;        }
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    private class VoidMultiplexerWithSchemaPredicate extends VoidMultiplexer {
&nbsp;
&nbsp;        private Consumer&lt;JsonValue&gt; action;
&nbsp;
<b class="fc">&nbsp;        VoidMultiplexerWithSchemaPredicate(Consumer&lt;JsonValue&gt; action) {</b>
<b class="fc">&nbsp;            super(JsonObject.class, action);</b>
<b class="fc">&nbsp;            this.action = action;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override Void requireAny() {
<b class="fc">&nbsp;            if (typeOfValue() == Boolean.class) {</b>
<b class="fc">&nbsp;                action.accept(JsonValue.this);</b>
<b class="fc">&nbsp;                return null;</b>
&nbsp;            }
<b class="fc">&nbsp;            return super.requireAny();</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        protected SchemaException multiplexFailure() {
<b class="fc">&nbsp;            Set&lt;Class&lt;?&gt;&gt; expectedTypes = new HashSet&lt;&gt;(actions.keySet());</b>
<b class="fc">&nbsp;            expectedTypes.add(Boolean.class);</b>
<b class="fc">&nbsp;            return ls.createSchemaException(typeOfValue(), expectedTypes);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
<b class="fc">&nbsp;    private static final Function&lt;?, ?&gt; IDENTITY = e -&gt; e;</b>
&nbsp;
&nbsp;    static final &lt;T, R&gt; Function&lt;T, R&gt; identity() {
<b class="fc">&nbsp;        return (Function&lt;T, R&gt;) IDENTITY;</b>
&nbsp;    }
&nbsp;
&nbsp;    static JsonValue of(Object obj) {
<b class="fc">&nbsp;        if (obj instanceof JsonValue) {</b>
<b class="fc">&nbsp;            return (JsonValue) obj;</b>
<b class="fc">&nbsp;        } else if (obj instanceof Map) {</b>
<b class="fc">&nbsp;            return new JsonObject((Map&lt;String, Object&gt;) obj);</b>
<b class="fc">&nbsp;        } else if (obj instanceof List) {</b>
<b class="fc">&nbsp;            return new JsonArray((List&lt;Object&gt;) obj);</b>
<b class="fc">&nbsp;        } else if (obj instanceof JSONObject) {</b>
<b class="fc">&nbsp;            return new JsonObject(toMap((JSONObject) obj));</b>
<b class="fc">&nbsp;        } else if (obj instanceof JSONArray) {</b>
<b class="fc">&nbsp;            return new JsonArray(toList((JSONArray) obj));</b>
&nbsp;        }
<b class="fc">&nbsp;        return new JsonValue(obj);</b>
&nbsp;    }
&nbsp;
&nbsp;    protected Object value() {
<b class="fc">&nbsp;        return obj;</b>
&nbsp;    }
&nbsp;
&nbsp;    protected Object unwrap() {
<b class="fc">&nbsp;        return value();</b>
&nbsp;    }
&nbsp;
&nbsp;    private final Object obj;
&nbsp;
&nbsp;    protected LoadingState ls;
&nbsp;
<b class="fc">&nbsp;    protected JsonValue(Object obj) {</b>
<b class="fc">&nbsp;        this.obj = obj;</b>
&nbsp;    }
&nbsp;
&nbsp;    public &lt;T&gt; VoidMultiplexer canBe(Class&lt;T&gt; expectedType, Consumer&lt;T&gt; consumer) {
<b class="fc">&nbsp;        return new VoidMultiplexer(expectedType, consumer);</b>
&nbsp;    }
&nbsp;
&nbsp;    public VoidMultiplexer canBeSchema(Consumer&lt;JsonValue&gt; consumer) {
<b class="fc">&nbsp;        if (DRAFT_4.equals(this.ls.specVersion())) {</b>
<b class="fc">&nbsp;            return new VoidMultiplexer(JsonObject.class, consumer);</b>
&nbsp;        } else {
<b class="fc">&nbsp;            return new VoidMultiplexerWithSchemaPredicate(consumer);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public &lt;T, R&gt; Multiplexer&lt;R&gt; canBeMappedTo(Class&lt;T&gt; expectedType, Function&lt;T, R&gt; mapper) {
<b class="fc">&nbsp;        return new Multiplexer&lt;R&gt;(expectedType, mapper);</b>
&nbsp;    }
&nbsp;
&nbsp;    protected Class&lt;?&gt; typeOfValue() {
<b class="fc">&nbsp;        return obj == null ? null : obj.getClass();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override public boolean equals(Object o) {
<b class="pc">&nbsp;        if (this == o)</b>
<b class="nc">&nbsp;            return true;</b>
<b class="pc">&nbsp;        if (o == null || getClass() != o.getClass())</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;
<b class="fc">&nbsp;        JsonValue that = (JsonValue) o;</b>
&nbsp;
<b class="fc">&nbsp;        return Objects.equals(obj, that.obj);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override public int hashCode() {
<b class="pc">&nbsp;        return obj != null ? obj.hashCode() : 0;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override public String toString() {
<b class="nc">&nbsp;        return &quot;JsonValue{&quot; +</b>
&nbsp;                &quot;obj=&quot; + obj +
&nbsp;                &#39;}&#39;;
&nbsp;    }
&nbsp;
&nbsp;    public String requireString() {
<b class="fc">&nbsp;        return requireString(identity());</b>
&nbsp;    }
&nbsp;
&nbsp;    public &lt;R&gt; R requireString(Function&lt;String, R&gt; mapper) {
<b class="fc">&nbsp;        if (obj instanceof String) {</b>
<b class="fc">&nbsp;            return mapper.apply((String) obj);</b>
&nbsp;        }
<b class="fc">&nbsp;        throw ls.createSchemaException(typeOfValue(), String.class);</b>
&nbsp;    }
&nbsp;
&nbsp;    public Boolean requireBoolean() {
<b class="fc">&nbsp;        return requireBoolean(identity());</b>
&nbsp;    }
&nbsp;
&nbsp;    public &lt;R&gt; R requireBoolean(Function&lt;Boolean, R&gt; mapper) {
<b class="fc">&nbsp;        if (obj instanceof Boolean) {</b>
<b class="fc">&nbsp;            return mapper.apply((Boolean) obj);</b>
&nbsp;        }
<b class="fc">&nbsp;        throw ls.createSchemaException(typeOfValue(), Boolean.class);</b>
&nbsp;    }
&nbsp;
&nbsp;    public JsonObject requireObject() {
<b class="fc">&nbsp;        return requireObject(identity());</b>
&nbsp;    }
&nbsp;
&nbsp;    public &lt;R&gt; R requireObject(Function&lt;JsonObject, R&gt; mapper) {
<b class="fc">&nbsp;        throw ls.createSchemaException(typeOfValue(), JsonObject.class);</b>
&nbsp;    }
&nbsp;
&nbsp;    public JsonArray requireArray() {
<b class="fc">&nbsp;        return requireArray(identity());</b>
&nbsp;    }
&nbsp;
&nbsp;    public &lt;R&gt; R requireArray(Function&lt;JsonArray, R&gt; mapper) {
<b class="fc">&nbsp;        throw ls.createSchemaException(typeOfValue(), JsonArray.class);</b>
&nbsp;    }
&nbsp;
&nbsp;    public Number requireNumber() {
<b class="fc">&nbsp;        return requireNumber(identity());</b>
&nbsp;    }
&nbsp;
&nbsp;    public &lt;R&gt; R requireNumber(Function&lt;Number, R&gt; mapper) {
<b class="fc">&nbsp;        if (obj instanceof Number) {</b>
<b class="fc">&nbsp;            return mapper.apply((Number) obj);</b>
&nbsp;        }
<b class="fc">&nbsp;        throw ls.createSchemaException(typeOfValue(), Number.class);</b>
&nbsp;    }
&nbsp;
&nbsp;    public Integer requireInteger() {
<b class="fc">&nbsp;        return requireInteger(identity());</b>
&nbsp;    }
&nbsp;
&nbsp;    public &lt;R&gt; R requireInteger(Function&lt;Integer, R&gt; mapper) {
<b class="fc">&nbsp;        if (obj instanceof Integer) {</b>
<b class="fc">&nbsp;            return mapper.apply((Integer) obj);</b>
&nbsp;        }
<b class="fc">&nbsp;        throw ls.createSchemaException(typeOfValue(), Integer.class);</b>
&nbsp;    }
&nbsp;
&nbsp;    protected static Object deepToOrgJson(JsonValue v) {
<b class="pc">&nbsp;        if (v.unwrap() == null) {</b>
<b class="nc">&nbsp;            return JSONObject.NULL;</b>
&nbsp;        }
<b class="fc">&nbsp;        if (v instanceof JsonObject) {</b>
<b class="fc">&nbsp;            JSONObject obj = new JSONObject();</b>
<b class="fc">&nbsp;            ((JsonObject) v).forEach((key, value) -&gt; obj.put(key, deepToOrgJson(value)));</b>
<b class="fc">&nbsp;            return obj;</b>
<b class="fc">&nbsp;        } else if (v instanceof JsonArray) {</b>
<b class="fc">&nbsp;            JSONArray array = new JSONArray();</b>
<b class="fc">&nbsp;            ((JsonArray) v).forEach((index, value) -&gt; array.put(deepToOrgJson(value)));</b>
<b class="fc">&nbsp;            return array;</b>
&nbsp;        } else
<b class="fc">&nbsp;            return v.unwrap();</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-11-01 17:20</div>
</div>
</body>
</html>
