


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=windows-1252"> 
  <title>Coverage Report > ToStringVisitor</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.everit.json.schema</a>
</div>

<h1>Coverage Summary for Class: ToStringVisitor (org.everit.json.schema)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">ToStringVisitor</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (48/48)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    95%
  </span>
  <span class="absValue">
    (38/40)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (168/168)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package org.everit.json.schema;
&nbsp;
&nbsp;import static org.everit.json.schema.FormatValidator.NONE;
&nbsp;
&nbsp;import java.util.List;
&nbsp;import java.util.Map;
&nbsp;import java.util.Set;
&nbsp;
&nbsp;import org.everit.json.schema.internal.JSONPrinter;
&nbsp;import org.everit.json.schema.loader.SpecificationVersion;
&nbsp;import org.everit.json.schema.regexp.Regexp;
&nbsp;import org.json.JSONException;
&nbsp;
&nbsp;class ToStringVisitor extends Visitor {
&nbsp;
&nbsp;    private final JSONPrinter writer;
&nbsp;
<b class="fc">&nbsp;    private boolean jsonObjectIsOpenForCurrentSchemaInstance = false;</b>
&nbsp;
<b class="fc">&nbsp;    private boolean skipNextObject = false;</b>
&nbsp;
&nbsp;    private SpecificationVersion deducedSpecVersion;
&nbsp;
<b class="fc">&nbsp;    ToStringVisitor(JSONPrinter writer) {</b>
<b class="fc">&nbsp;        this.writer = writer;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override void visitSchema(Schema schema) {
<b class="pc">&nbsp;        if (schema == null) {</b>
&nbsp;            return;
&nbsp;        }
<b class="fc">&nbsp;        if (!jsonObjectIsOpenForCurrentSchemaInstance) {</b>
<b class="fc">&nbsp;            writer.object();</b>
&nbsp;        }
<b class="fc">&nbsp;        writer.ifPresent(&quot;title&quot;, schema.getTitle());</b>
<b class="fc">&nbsp;        writer.ifPresent(&quot;description&quot;, schema.getDescription());</b>
<b class="fc">&nbsp;        writer.ifPresent(&quot;nullable&quot;, schema.isNullable());</b>
<b class="fc">&nbsp;        writer.ifPresent(&quot;default&quot;, schema.getDefaultValue());</b>
<b class="fc">&nbsp;        writer.ifPresent(&quot;readOnly&quot;, schema.isReadOnly());</b>
<b class="fc">&nbsp;        writer.ifPresent(&quot;writeOnly&quot;, schema.isWriteOnly());</b>
<b class="fc">&nbsp;        super.visitSchema(schema);</b>
<b class="fc">&nbsp;        Object schemaKeywordValue = schema.getUnprocessedProperties().get(&quot;$schema&quot;);</b>
<b class="fc">&nbsp;        String idKeyword = deduceSpecVersion(schemaKeywordValue).idKeyword();</b>
<b class="fc">&nbsp;        writer.ifPresent(idKeyword, schema.getId());</b>
<b class="fc">&nbsp;        schema.getUnprocessedProperties().forEach((key, val) -&gt; writer.key(key).value(val));</b>
<b class="fc">&nbsp;        schema.describePropertiesTo(writer);</b>
<b class="fc">&nbsp;        if (!jsonObjectIsOpenForCurrentSchemaInstance) {</b>
<b class="fc">&nbsp;            writer.endObject();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private SpecificationVersion deduceSpecVersion(Object schemaKeywordValue) {
<b class="fc">&nbsp;        if (deducedSpecVersion != null) {</b>
<b class="fc">&nbsp;            return deducedSpecVersion;</b>
&nbsp;        }
<b class="fc">&nbsp;        if (schemaKeywordValue instanceof String) {</b>
<b class="fc">&nbsp;            return deducedSpecVersion = SpecificationVersion.lookupByMetaSchemaUrl((String) schemaKeywordValue)</b>
<b class="fc">&nbsp;                    .orElse(SpecificationVersion.DRAFT_4);</b>
&nbsp;        } else {
<b class="fc">&nbsp;            return deducedSpecVersion = SpecificationVersion.DRAFT_4;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void printInJsonObject(Runnable task) {
<b class="fc">&nbsp;        if (skipNextObject) {</b>
<b class="fc">&nbsp;            skipNextObject = false;</b>
<b class="fc">&nbsp;            jsonObjectIsOpenForCurrentSchemaInstance = true;</b>
<b class="fc">&nbsp;            task.run();</b>
<b class="fc">&nbsp;            jsonObjectIsOpenForCurrentSchemaInstance = false;</b>
&nbsp;        } else {
<b class="fc">&nbsp;            writer.object();</b>
<b class="fc">&nbsp;            jsonObjectIsOpenForCurrentSchemaInstance = true;</b>
<b class="fc">&nbsp;            task.run();</b>
<b class="fc">&nbsp;            writer.endObject();</b>
<b class="fc">&nbsp;            jsonObjectIsOpenForCurrentSchemaInstance = false;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    void visitBooleanSchema(BooleanSchema schema) {
<b class="fc">&nbsp;        printInJsonObject(() -&gt; {</b>
<b class="fc">&nbsp;            super.visitBooleanSchema(schema);</b>
<b class="fc">&nbsp;            writer.key(&quot;type&quot;).value(&quot;boolean&quot;);</b>
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;    @Override void visitArraySchema(ArraySchema schema) {
<b class="fc">&nbsp;        printInJsonObject(() -&gt; {</b>
<b class="fc">&nbsp;            if (schema.requiresArray()) {</b>
<b class="fc">&nbsp;                writer.key(&quot;type&quot;).value(&quot;array&quot;);</b>
&nbsp;            }
<b class="fc">&nbsp;            writer.ifTrue(&quot;uniqueItems&quot;, schema.needsUniqueItems())</b>
<b class="fc">&nbsp;                    .ifPresent(&quot;minItems&quot;, schema.getMinItems())</b>
<b class="fc">&nbsp;                    .ifPresent(&quot;maxItems&quot;, schema.getMaxItems())</b>
<b class="fc">&nbsp;                    .ifFalse(&quot;additionalItems&quot;, schema.permitsAdditionalItems());</b>
<b class="fc">&nbsp;            super.visitArraySchema(schema);</b>
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;    @Override void visit(Schema schema) {
<b class="fc">&nbsp;        boolean orig = jsonObjectIsOpenForCurrentSchemaInstance;</b>
<b class="fc">&nbsp;        jsonObjectIsOpenForCurrentSchemaInstance = false;</b>
<b class="fc">&nbsp;        super.visit(schema);</b>
<b class="fc">&nbsp;        jsonObjectIsOpenForCurrentSchemaInstance = orig;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override void visitAllItemSchema(Schema allItemSchema) {
<b class="fc">&nbsp;        writer.key(&quot;items&quot;);</b>
<b class="fc">&nbsp;        visit(allItemSchema);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override void visitEmptySchema(EmptySchema emptySchema) {
<b class="fc">&nbsp;        if (emptySchema instanceof TrueSchema) {</b>
<b class="fc">&nbsp;            writer.value(true);</b>
&nbsp;        } else {
<b class="fc">&nbsp;            printInJsonObject(() -&gt; super.visitEmptySchema(emptySchema));</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override void visitItemSchemas(List&lt;Schema&gt; itemSchemas) {
<b class="fc">&nbsp;        writer.key(&quot;items&quot;);</b>
<b class="fc">&nbsp;        writer.array();</b>
<b class="fc">&nbsp;        super.visitItemSchemas(itemSchemas);</b>
<b class="fc">&nbsp;        writer.endArray();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override void visitItemSchema(int index, Schema itemSchema) {
<b class="fc">&nbsp;        visit(itemSchema);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override void visitSchemaOfAdditionalItems(Schema schemaOfAdditionalItems) {
<b class="fc">&nbsp;        writer.key(&quot;additionalItems&quot;);</b>
<b class="fc">&nbsp;        visit(schemaOfAdditionalItems);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override void visitContainedItemSchema(Schema containedItemSchema) {
<b class="fc">&nbsp;        writer.key(&quot;contains&quot;);</b>
<b class="fc">&nbsp;        visit(containedItemSchema);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override void visitConditionalSchema(ConditionalSchema conditionalSchema) {
<b class="fc">&nbsp;        printInJsonObject(() -&gt; super.visitConditionalSchema(conditionalSchema));</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override void visitNotSchema(NotSchema notSchema) {
<b class="fc">&nbsp;        printInJsonObject(() -&gt; {</b>
<b class="fc">&nbsp;            visitSchema(notSchema);</b>
<b class="fc">&nbsp;            writer.key(&quot;not&quot;);</b>
<b class="fc">&nbsp;            notSchema.getMustNotMatch().accept(this);</b>
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;    @Override void visitNumberSchema(NumberSchema schema) {
<b class="fc">&nbsp;        printInJsonObject(() -&gt; {</b>
<b class="fc">&nbsp;            if (schema.requiresInteger()) {</b>
<b class="fc">&nbsp;                writer.key(&quot;type&quot;).value(&quot;integer&quot;);</b>
<b class="fc">&nbsp;            } else if (schema.isRequiresNumber()) {</b>
<b class="fc">&nbsp;                writer.key(&quot;type&quot;).value(&quot;number&quot;);</b>
&nbsp;            }
<b class="fc">&nbsp;            writer.ifPresent(&quot;minimum&quot;, schema.getMinimum());</b>
<b class="fc">&nbsp;            writer.ifPresent(&quot;maximum&quot;, schema.getMaximum());</b>
<b class="fc">&nbsp;            writer.ifPresent(&quot;multipleOf&quot;, schema.getMultipleOf());</b>
<b class="fc">&nbsp;            writer.ifTrue(&quot;exclusiveMinimum&quot;, schema.isExclusiveMinimum());</b>
<b class="fc">&nbsp;            writer.ifTrue(&quot;exclusiveMaximum&quot;, schema.isExclusiveMaximum());</b>
&nbsp;            try {
<b class="fc">&nbsp;                writer.ifPresent(&quot;exclusiveMinimum&quot;, schema.getExclusiveMinimumLimit());</b>
<b class="fc">&nbsp;                writer.ifPresent(&quot;exclusiveMaximum&quot;, schema.getExclusiveMaximumLimit());</b>
<b class="fc">&nbsp;            } catch (JSONException e) {</b>
<b class="fc">&nbsp;                throw new IllegalStateException(&quot;overloaded use of exclusiveMinimum or exclusiveMaximum keyword&quot;);</b>
<b class="fc">&nbsp;            }</b>
<b class="fc">&nbsp;            super.visitNumberSchema(schema);</b>
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;    @Override void visitConstSchema(ConstSchema constSchema) {
<b class="fc">&nbsp;        printInJsonObject(() -&gt; {</b>
<b class="fc">&nbsp;            writer.key(&quot;const&quot;);</b>
<b class="fc">&nbsp;            writer.value(constSchema.getPermittedValue());</b>
<b class="fc">&nbsp;            super.visitConstSchema(constSchema);</b>
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;    @Override void visitObjectSchema(ObjectSchema schema) {
<b class="fc">&nbsp;        printInJsonObject(() -&gt; {</b>
<b class="fc">&nbsp;            if (schema.requiresObject()) {</b>
<b class="fc">&nbsp;                writer.key(&quot;type&quot;).value(&quot;object&quot;);</b>
&nbsp;            }
<b class="fc">&nbsp;            writer.ifPresent(&quot;minProperties&quot;, schema.getMinProperties());</b>
<b class="fc">&nbsp;            writer.ifPresent(&quot;maxProperties&quot;, schema.getMaxProperties());</b>
<b class="fc">&nbsp;            if (!schema.getPropertyDependencies().isEmpty()) {</b>
<b class="fc">&nbsp;                describePropertyDependencies(schema.getPropertyDependencies());</b>
&nbsp;            }
<b class="fc">&nbsp;            if (!schema.getSchemaDependencies().isEmpty()) {</b>
<b class="fc">&nbsp;                writer.key(&quot;dependencies&quot;);</b>
<b class="fc">&nbsp;                printSchemaMap(schema.getSchemaDependencies());</b>
&nbsp;            }
<b class="fc">&nbsp;            writer.ifFalse(&quot;additionalProperties&quot;, schema.permitsAdditionalProperties());</b>
<b class="fc">&nbsp;            super.visitObjectSchema(schema);</b>
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;    @Override void visitRequiredProperties(List&lt;String&gt; requiredProperties) {
<b class="fc">&nbsp;        if (!requiredProperties.isEmpty()) {</b>
<b class="fc">&nbsp;            writer.key(&quot;required&quot;).value(requiredProperties);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override void visitSchemaOfAdditionalProperties(Schema schemaOfAdditionalProperties) {
<b class="fc">&nbsp;        writer.key(&quot;additionalProperties&quot;);</b>
<b class="fc">&nbsp;        visit(schemaOfAdditionalProperties);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void describePropertyDependencies(Map&lt;String, Set&lt;String&gt;&gt; propertyDependencies) {
<b class="fc">&nbsp;        writer.key(&quot;dependencies&quot;);</b>
<b class="fc">&nbsp;        writer.object();</b>
<b class="fc">&nbsp;        propertyDependencies.forEach((key, value) -&gt; {</b>
<b class="fc">&nbsp;            writer.key(key);</b>
<b class="fc">&nbsp;            writer.array();</b>
<b class="fc">&nbsp;            value.forEach(writer::value);</b>
<b class="fc">&nbsp;            writer.endArray();</b>
&nbsp;        });
<b class="fc">&nbsp;        writer.endObject();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override void visitPropertyNameSchema(Schema propertyNameSchema) {
<b class="fc">&nbsp;        writer.key(&quot;propertyNames&quot;);</b>
<b class="fc">&nbsp;        visit(propertyNameSchema);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override void visitPropertySchemas(Map&lt;String, Schema&gt; propertySchemas) {
<b class="fc">&nbsp;        if (!propertySchemas.isEmpty()) {</b>
<b class="fc">&nbsp;            writer.key(&quot;properties&quot;);</b>
<b class="fc">&nbsp;            printSchemaMap(propertySchemas);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void printSchemaMap(Map&lt;?, Schema&gt; schemas) {
<b class="fc">&nbsp;        writer.object();</b>
<b class="fc">&nbsp;        schemas.forEach((key, value) -&gt; {</b>
<b class="fc">&nbsp;            writer.key(key.toString());</b>
<b class="fc">&nbsp;            visit(value);</b>
&nbsp;        });
<b class="fc">&nbsp;        writer.endObject();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override void visitPatternProperties(Map&lt;Regexp, Schema&gt; patternProperties) {
<b class="fc">&nbsp;        if (!patternProperties.isEmpty()) {</b>
<b class="fc">&nbsp;            writer.key(&quot;patternProperties&quot;);</b>
<b class="fc">&nbsp;            printSchemaMap(patternProperties);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override void visitCombinedSchema(CombinedSchema combinedSchema) {
<b class="fc">&nbsp;        printInJsonObject(() -&gt; {</b>
<b class="fc">&nbsp;            super.visitCombinedSchema(combinedSchema);</b>
<b class="fc">&nbsp;            if (combinedSchema.isSynthetic()) {</b>
<b class="fc">&nbsp;                combinedSchema.getSubschemas().forEach(subschema -&gt; {</b>
<b class="fc">&nbsp;                    this.skipNextObject = true;</b>
<b class="fc">&nbsp;                    super.visit(subschema);</b>
&nbsp;                });
&nbsp;            } else {
<b class="fc">&nbsp;                writer.key(combinedSchema.getCriterion().toString());</b>
<b class="fc">&nbsp;                writer.array();</b>
<b class="fc">&nbsp;                combinedSchema.getSubschemas().forEach(subschema -&gt; subschema.accept(this));</b>
<b class="fc">&nbsp;                writer.endArray();</b>
&nbsp;            }
&nbsp;        });
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    @Override void visitIfSchema(Schema ifSchema) {
<b class="fc">&nbsp;        writer.key(&quot;if&quot;);</b>
<b class="fc">&nbsp;        visit(ifSchema);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override void visitThenSchema(Schema thenSchema) {
<b class="fc">&nbsp;        writer.key(&quot;then&quot;);</b>
<b class="fc">&nbsp;        visit(thenSchema);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override void visitElseSchema(Schema elseSchema) {
<b class="fc">&nbsp;        writer.key(&quot;else&quot;);</b>
<b class="fc">&nbsp;        visit(elseSchema);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override void visitFalseSchema(FalseSchema falseSchema) {
<b class="fc">&nbsp;        writer.value(false);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override void visitNullSchema(NullSchema nullSchema) {
<b class="fc">&nbsp;        printInJsonObject(() -&gt; {</b>
<b class="fc">&nbsp;            writer.key(&quot;type&quot;);</b>
<b class="fc">&nbsp;            writer.value(&quot;null&quot;);</b>
<b class="fc">&nbsp;            super.visitNullSchema(nullSchema);</b>
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;    @Override void visitStringSchema(StringSchema schema) {
<b class="fc">&nbsp;        printInJsonObject(() -&gt; {</b>
<b class="fc">&nbsp;            if (schema.requireString()) {</b>
<b class="fc">&nbsp;                writer.key(&quot;type&quot;).value(&quot;string&quot;);</b>
&nbsp;            }
<b class="fc">&nbsp;            writer.ifPresent(&quot;minLength&quot;, schema.getMinLength());</b>
<b class="fc">&nbsp;            writer.ifPresent(&quot;maxLength&quot;, schema.getMaxLength());</b>
<b class="fc">&nbsp;            writer.ifPresent(&quot;pattern&quot;, schema.getPattern());</b>
<b class="pc">&nbsp;            if (schema.getFormatValidator() != null &amp;&amp; !NONE.equals(schema.getFormatValidator())) {</b>
<b class="fc">&nbsp;                writer.key(&quot;format&quot;).value(schema.getFormatValidator().formatName());</b>
&nbsp;            }
<b class="fc">&nbsp;            super.visitStringSchema(schema);</b>
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;    @Override void visitEnumSchema(EnumSchema schema) {
<b class="fc">&nbsp;        printInJsonObject(() -&gt; {</b>
<b class="fc">&nbsp;            writer.key(&quot;enum&quot;);</b>
<b class="fc">&nbsp;            writer.array();</b>
<b class="fc">&nbsp;            schema.getPossibleValues().forEach(writer::value);</b>
<b class="fc">&nbsp;            writer.endArray();</b>
<b class="fc">&nbsp;            super.visitEnumSchema(schema);</b>
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;    @Override void visitReferenceSchema(ReferenceSchema referenceSchema) {
<b class="fc">&nbsp;        printInJsonObject(() -&gt; {</b>
<b class="fc">&nbsp;            writer.key(&quot;$ref&quot;);</b>
<b class="fc">&nbsp;            writer.value(referenceSchema.getReferenceValue());</b>
<b class="fc">&nbsp;            super.visitReferenceSchema(referenceSchema);</b>
&nbsp;        });
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-11-01 17:20</div>
</div>
</body>
</html>
