


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=windows-1252"> 
  <title>Coverage Report > StringToValueConverter</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.everit.json.schema</a>
</div>

<h1>Coverage Summary for Class: StringToValueConverter (org.everit.json.schema)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">StringToValueConverter</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    80%
  </span>
  <span class="absValue">
    (4/5)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    50%
  </span>
  <span class="absValue">
    (30/60)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    58.3%
  </span>
  <span class="absValue">
    (28/48)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package org.everit.json.schema;
&nbsp;
&nbsp;import org.json.JSONObject;
&nbsp;
&nbsp;import java.math.BigDecimal;
&nbsp;import java.math.BigInteger;
&nbsp;import java.util.HashSet;
&nbsp;import java.util.Set;
&nbsp;import java.util.function.Consumer;
&nbsp;import java.util.function.Function;
&nbsp;
&nbsp;import static java.util.Arrays.asList;
&nbsp;
&nbsp;/**
&nbsp; * The methods of this class are copied from {@code org.json.JSONObject}.
&nbsp; *
&nbsp; * Although it would be possible to call {@code JSONObject#stringToValue()} from
&nbsp; * {@link ValidatingVisitor#ifPassesTypeCheck(Class, Function, boolean, Boolean, Consumer)}, we can not do it,
&nbsp; * because {@code JSONObject#stringToValue()} does not exist in the android flavor of the org.json package,
&nbsp; * therefore on android it would throw a {@link NoSuchMethodError}. For that reason, these methods are copied
&nbsp; * to the everit-org/json-schema library, to make sure that they exist at run-time.
&nbsp; *
&nbsp; * Furthermore, this implementation accepts all 22 boolean literals of YAML ( https://yaml.org/type/bool.html )
&nbsp; * as valid booleans.
&nbsp; */
<b class="nc">&nbsp;class StringToValueConverter {</b>
&nbsp;
<b class="fc">&nbsp;    private static final Set&lt;String&gt; YAML_BOOLEAN_TRUE_LITERALS = new HashSet&lt;&gt;(asList(</b>
&nbsp;            &quot;y&quot;,
&nbsp;            &quot;Y&quot;,
&nbsp;            &quot;yes&quot;,
&nbsp;            &quot;Yes&quot;,
&nbsp;            &quot;YES&quot;,
&nbsp;            &quot;true&quot;,
&nbsp;            &quot;True&quot;,
&nbsp;            &quot;TRUE&quot;,
&nbsp;            &quot;on&quot;,
&nbsp;            &quot;On&quot;,
&nbsp;            &quot;ON&quot;
&nbsp;    ));
&nbsp;
<b class="fc">&nbsp;    private static final Set&lt;String&gt; YAML_BOOLEAN_FALSE_LITERALS = new HashSet&lt;&gt;(asList(</b>
&nbsp;            &quot;n&quot;,
&nbsp;            &quot;N&quot;,
&nbsp;            &quot;no&quot;,
&nbsp;            &quot;No&quot;,
&nbsp;            &quot;NO&quot;,
&nbsp;            &quot;false&quot;,
&nbsp;            &quot;False&quot;,
&nbsp;            &quot;FALSE&quot;,
&nbsp;            &quot;off&quot;,
&nbsp;            &quot;Off&quot;,
&nbsp;            &quot;OFF&quot;
&nbsp;    ));
&nbsp;
&nbsp;
&nbsp;
&nbsp;    static Object stringToValue(String string) {
<b class="fc">&nbsp;        if (&quot;&quot;.equals(string)) {</b>
<b class="fc">&nbsp;            return string;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (YAML_BOOLEAN_TRUE_LITERALS.contains(string)) {</b>
<b class="fc">&nbsp;            return Boolean.TRUE;</b>
&nbsp;        }
<b class="fc">&nbsp;        if (YAML_BOOLEAN_FALSE_LITERALS.contains(string)) {</b>
<b class="fc">&nbsp;            return Boolean.FALSE;</b>
&nbsp;        }
<b class="fc">&nbsp;        if (&quot;null&quot;.equalsIgnoreCase(string)) {</b>
<b class="fc">&nbsp;            return JSONObject.NULL;</b>
&nbsp;        }
&nbsp;
&nbsp;        /*
&nbsp;         * If it might be a number, try converting it. If a number cannot be
&nbsp;         * produced, then the value will just be a string.
&nbsp;         */
&nbsp;
<b class="fc">&nbsp;        char initial = string.charAt(0);</b>
<b class="pc">&nbsp;        if ((initial &gt;= &#39;0&#39; &amp;&amp; initial &lt;= &#39;9&#39;) || initial == &#39;-&#39;) {</b>
&nbsp;            try {
<b class="fc">&nbsp;                return stringToNumber(string);</b>
<b class="nc">&nbsp;            } catch (Exception ignore) {</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return string;</b>
&nbsp;    }
&nbsp;
&nbsp;    private static boolean isDecimalNotation(final String val) {
<b class="pc">&nbsp;        return val.indexOf(&#39;.&#39;) &gt; -1 || val.indexOf(&#39;e&#39;) &gt; -1</b>
<b class="pc">&nbsp;                || val.indexOf(&#39;E&#39;) &gt; -1 || &quot;-0&quot;.equals(val);</b>
&nbsp;    }
&nbsp;
&nbsp;    private static Number stringToNumber(final String val) throws NumberFormatException {
<b class="fc">&nbsp;        char initial = val.charAt(0);</b>
<b class="pc">&nbsp;        if ((initial &gt;= &#39;0&#39; &amp;&amp; initial &lt;= &#39;9&#39;) || initial == &#39;-&#39;) {</b>
&nbsp;            // decimal representation
<b class="fc">&nbsp;            if (isDecimalNotation(val)) {</b>
&nbsp;                // Use a BigDecimal all the time so we keep the original
&nbsp;                // representation. BigDecimal doesn&#39;t support -0.0, ensure we
&nbsp;                // keep that by forcing a decimal.
&nbsp;                try {
<b class="fc">&nbsp;                    BigDecimal bd = new BigDecimal(val);</b>
<b class="pc">&nbsp;                    if(initial == &#39;-&#39; &amp;&amp; BigDecimal.ZERO.compareTo(bd)==0) {</b>
<b class="fc">&nbsp;                        return Double.valueOf(-0.0);</b>
&nbsp;                    }
<b class="fc">&nbsp;                    return bd;</b>
<b class="nc">&nbsp;                } catch (NumberFormatException retryAsDouble) {</b>
&nbsp;                    // this is to support &quot;Hex Floats&quot; like this: 0x1.0P-1074
&nbsp;                    try {
<b class="nc">&nbsp;                        Double d = Double.valueOf(val);</b>
<b class="nc">&nbsp;                        if(d.isNaN() || d.isInfinite()) {</b>
<b class="nc">&nbsp;                            throw new NumberFormatException(&quot;val [&quot;+val+&quot;] is not a valid number.&quot;);</b>
&nbsp;                        }
<b class="nc">&nbsp;                        return d;</b>
<b class="nc">&nbsp;                    } catch (NumberFormatException ignore) {</b>
<b class="nc">&nbsp;                        throw new NumberFormatException(&quot;val [&quot;+val+&quot;] is not a valid number.&quot;);</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            }
&nbsp;            // block items like 00 01 etc. Java number parsers treat these as Octal.
<b class="pc">&nbsp;            if(initial == &#39;0&#39; &amp;&amp; val.length() &gt; 1) {</b>
<b class="nc">&nbsp;                char at1 = val.charAt(1);</b>
<b class="nc">&nbsp;                if(at1 &gt;= &#39;0&#39; &amp;&amp; at1 &lt;= &#39;9&#39;) {</b>
<b class="nc">&nbsp;                    throw new NumberFormatException(&quot;val [&quot;+val+&quot;] is not a valid number.&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;            } else if (initial == &#39;-&#39; &amp;&amp; val.length() &gt; 2) {</b>
<b class="nc">&nbsp;                char at1 = val.charAt(1);</b>
<b class="nc">&nbsp;                char at2 = val.charAt(2);</b>
<b class="nc">&nbsp;                if(at1 == &#39;0&#39; &amp;&amp; at2 &gt;= &#39;0&#39; &amp;&amp; at2 &lt;= &#39;9&#39;) {</b>
<b class="nc">&nbsp;                    throw new NumberFormatException(&quot;val [&quot;+val+&quot;] is not a valid number.&quot;);</b>
&nbsp;                }
&nbsp;            }
&nbsp;            // integer representation.
&nbsp;            // This will narrow any values to the smallest reasonable Object representation
&nbsp;            // (Integer, Long, or BigInteger)
&nbsp;
&nbsp;            // BigInteger down conversion: We use a similar bitLenth compare as
&nbsp;            // BigInteger#intValueExact uses. Increases GC, but objects hold
&nbsp;            // only what they need. i.e. Less runtime overhead if the value is
&nbsp;            // long lived.
<b class="fc">&nbsp;            BigInteger bi = new BigInteger(val);</b>
<b class="fc">&nbsp;            if(bi.bitLength() &lt;= 31){</b>
<b class="fc">&nbsp;                return Integer.valueOf(bi.intValue());</b>
&nbsp;            }
<b class="pc">&nbsp;            if(bi.bitLength() &lt;= 63){</b>
<b class="nc">&nbsp;                return Long.valueOf(bi.longValue());</b>
&nbsp;            }
<b class="fc">&nbsp;            return bi;</b>
&nbsp;        }
<b class="nc">&nbsp;        throw new NumberFormatException(&quot;val [&quot;+val+&quot;] is not a valid number.&quot;);</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-11-01 17:31</div>
</div>
</body>
</html>
